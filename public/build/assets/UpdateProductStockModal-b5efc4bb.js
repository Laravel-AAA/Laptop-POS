import{r as m,j as s,q as N}from"./app-097abe58.js";import{I as p,H as f}from"./Input-2335cbef.js";import{D as M,S as k}from"./SecondaryMaterialBtn-058727b8.js";import{S as q}from"./SecondaryButton-eac21188.js";import y from"./DefaultProductImg-5c8de8b6.js";import{C as T}from"./Checkbox-80cfdac9.js";import{N as h}from"./Num-1532f164.js";import{r as C}from"./index-c8d20cd6.js";import{E as U}from"./ErrorMessage-bea968d2.js";import{D as _}from"./ProductOptions-95a69545.js";import{P as w}from"./PrimaryMaterialBtn-1f504899.js";import{u as D}from"./useBetterForm-757eca25.js";import{T as S}from"./TemplateModal-f5721ff1.js";import{F as b}from"./FromDate-666062fb.js";import{K as u}from"./KeyValue-61166eac.js";import{n as B,c as W}from"./index.esm-722edfeb.js";function L({formProps:e,modalAction:a}){const t=a.state,i=e.data.img,[n,r]=m.useState(()=>"default");return t==="create"?s.jsx(g,{img:i,state:t,editImageState:n,form:e}):t==="show"?i===null?s.jsx(y,{}):s.jsx(v,{img:i,productName:e.data.name}):i===null?s.jsx(g,{img:i,state:t,editImageState:n,form:e}):n==="default"?s.jsxs(s.Fragment,{children:[s.jsx(v,{img:i,productName:e.data.name}),s.jsxs("div",{className:"mb-4 mt-1 flex justify-center gap-8",children:[s.jsx(q,{disabled:e.processing,onClick:()=>{r("change")},children:"Change Image"}),s.jsx(M,{disabled:e.processing,onClick:()=>{r("removed"),e.setData("img",null)},children:"Remove Image"})]})]}):s.jsx(g,{img:i,state:t,editImageState:n,form:e})}function v({img:e,productName:a}){return s.jsx("div",{className:"mt-1  rounded-md border border-gray-300",children:s.jsx("img",{className:"mx-auto h-40",src:e!=null&&e.startsWith("http")?e:"products-images/"+e,alt:"Image "+(e??"")+" of product "+a})})}function g({img:e,state:a,editImageState:t,form:i}){return s.jsx(s.Fragment,{children:s.jsx(p,{label:(e===null&&a==="edit"||t==="removed"||a==="create"?"Choose ":t==="change"?"Change ":"")+"Image",type:"file",className:"mt-1 block w-full",accept:"image/*",hidden:!!e,disabled:a==="show"||i.processing,required:!1,onChange:n=>{var r;i.setData("imageFile",((r=n.target.files)==null?void 0:r[0])??null)},errorMsg:i.errors.img||i.errors.imageFile,hideError:i.isDirty("img")||i.isDirty("imageFile"),hint:"We recommend an image with white background"})})}function V({color:e="teal",variant:a="outlined",size:t="lg",className:i="",errorMsg:n,errorMsgProps:r,hideError:o,error:c,hint:l,hintProps:d,label:x,disabled:j,required:P,autoComplete:z="off",id:E=x.toLowerCase().replaceAll(/[^\w]/g,"-"),name:I=x.toLowerCase().replaceAll(/[^\w]/g,"-"),ref:G,...F}){return c===void 0&&(o===!0?c=!1:n?c=!0:c=!1),s.jsxs(s.Fragment,{children:[s.jsx(C.Textarea,{id:E,name:I,label:x,"aria-label":x,className:i+" focus:ring-0",variant:a,color:e,size:t,error:c,disabled:j,required:j===!0?!1:P,...F}),s.jsx(U,{message:n,...r}),typeof l=="string"?s.jsx(f,{message:l,...d}):s.jsx(f,{children:l})]})}function H({formProps:e,modalAction:a}){const[t,i]=m.useState(!1),[n,r]=m.useState(e.data.price),o=N().props.auth.business.taxPercent;function c(l){return l==null?l:Number(Number(l).toFixed(8))}return s.jsxs("div",{className:"",children:[s.jsx("div",{className:"w-full",children:s.jsx(p,{id:"name",label:"Product Name",name:"name",type:"text",value:e.data.name??void 0,className:"mt-1 block w-full",autoComplete:"off",autoFocus:!0,disabled:a.state==="show"||e.processing,onChange:l=>e.setData("name",l.target.value),required:!0,errorMsg:e.errors.name,hideError:e.isDirty("name")})}),s.jsxs("div",{className:"mt-4",children:[s.jsx(p,{id:"price",label:"Price",type:"number",inputMode:"decimal",autoComplete:"off",name:"price",value:n??void 0,className:"mt-1 block w-full",disabled:a.state==="show"||e.processing,onChange:l=>{const d=c(l.target.value);r(d),e.setData("price",c(t?(d??0)/(1+o):d))},errorMsg:e.errors.price,hideError:e.isDirty("price"),required:!1,hint:a.state==="edit"&&s.jsx("span",{children:"If you change the price of this product, it may affect the bills that have already been issued with the old price. This could result in incorrect calculations, such as the total price of a bill. Please make sure you have no bills that have this product."})}),s.jsx(T,{label:s.jsxs("span",{children:["Price includes tax (",s.jsx(h,{showCurrency:!0,amount:e.data.price??0})," without tax)"]}),checked:t,errorMsg:void 0,disabled:e.processing,onChange:l=>{i(d=>(e.setData("price",c(n!=null&&!d?n/(1+o):n)),!d))}})]}),s.jsx("div",{className:"mt-3",children:s.jsx(p,{id:"stock",label:"Stock",type:"number",name:"stock",value:e.data.stock??void 0,className:"mt-1 block w-full",disabled:a.state==="show"||e.processing,onChange:l=>e.setData("stock",Number(l.target.value)),errorMsg:e.errors.stock,hideError:e.isDirty("stock"),required:!1})}),s.jsx("div",{className:"mt-4",children:s.jsx(p,{label:"Barcode",type:"number",name:"barcode",value:e.data.barcode??void 0,className:"remove-arrow mt-1 block w-full",disabled:a.state==="show"||e.processing,onChange:l=>e.setData("barcode",l.target.value),errorMsg:e.errors.barcode,hideError:e.isDirty("barcode"),required:!1})}),s.jsx("div",{className:"mt-4",children:s.jsx(L,{formProps:e,modalAction:a})}),s.jsx("div",{className:"mt-4",children:s.jsx(V,{label:"Description",value:e.data.description??void 0,onChange:l=>e.setData("description",l.target.value),disabled:a.state==="show"||e.processing,required:!1,errorMsg:e.errors.description,hideError:e.isDirty("description")})})]})}function K({modalAction:e,setModalAction:a,form:t}){const[i,n]=m.useState(!1);return s.jsxs("div",{className:"mt-4 flex flex-col gap-4 sm:flex-row-reverse",children:[s.jsxs(w,{type:"submit",disabled:t.processing,children:[" ",e.state==="create"?"Create":"Save"]}),s.jsx(k,{type:"button",onClick:()=>{t.cancel(),a(r=>({...r,open:!1})),t.reset(),t.clearErrors()},children:"Cancel"}),s.jsx(_,{isOpen:i,requestClose:r=>{n(!1),(r==null?void 0:r.toLowerCase().trim())==="delete"&&a(o=>({...o,open:!1}))},product:t.data})]})}function O({modalAction:e,setModalAction:a}){const t=D(e.state==="create"?{name:"",barcode:null,description:null,imageFile:null,img:null,price:null,stock:null}:{...e.data,_method:"patch"},e.data?e.data.id.toString()+e.data.img:e.state);function i(n){n.preventDefault(),t.post(route(`product.${e.state==="edit"?"update":"store"}`,e.state==="edit"?e.data.id:void 0),{preserveScroll:!0,onSuccess:()=>{t.clearErrors(),t.reset(),a(()=>({state:"create",data:null,open:!1}))}})}return s.jsxs("form",{className:"mt-3",onSubmit:i,children:[s.jsx(H,{formProps:t,modalAction:e}),s.jsx(K,{modalAction:e,setModalAction:a,form:t})]})}function R({product:e}){var n,r;const a=N().props.auth.business.taxPercent,[t,i]=m.useState(!1);return s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"rounded-md border border-blue-gray-100",children:e.img?s.jsx("img",{className:"mx-auto h-40",src:(n=e.img)!=null&&n.startsWith("http")?e.img:"products-images/"+e.img,alt:"Image of product "+e.name}):s.jsx(y,{className:"!my-1"})}),s.jsx(u,{k:"Name",v:e.name}),s.jsx(u,{k:"Price (Tax included)",v:s.jsx(h,{amount:e.price===null?null:e.price*(1+a),defaultNoAmount:!0,showCurrency:!0})}),s.jsx(u,{k:"Price (Tax not included)",v:s.jsx(h,{amount:e.price,defaultNoAmount:!0,showCurrency:!0})}),s.jsx(u,{k:"Stock",v:s.jsx(h,{amount:e.stock,defaultNoAmount:!0})}),s.jsx(u,{k:"Barcode",v:e.barcode}),s.jsx(u,{k:"Description",v:e.description}),s.jsxs("div",{className:"space-y-3 border-t",hidden:!t,children:[s.jsx(u,{className:"mt-3",k:"Created by",v:(r=e.created_by)==null?void 0:r.name}),s.jsx(u,{title:new Date(e.created_at).toDateString(),className:"mt-3",k:"Created",v:s.jsx(b,{date:e.created_at})}),s.jsx(u,{title:new Date(e.updated_at).toDateString(),className:"mt-3",k:"Updated",v:s.jsx(b,{date:e.updated_at})})]}),s.jsx("div",{className:"flex justify-center",children:s.jsx(C.IconButton,{title:"More info",className:"rounded-full",onClick:()=>i(o=>!o),children:t?s.jsx(B,{}):s.jsx(W,{})})})]})}function ue({modalAction:e,setModalAction:a}){return s.jsx(S,{title:$(e.state),open:e.open,closeModal:()=>a(t=>({...t,open:!1})),children:e.state==="show"?s.jsx(R,{product:e.data}):s.jsx(O,{modalAction:e,setModalAction:a})})}function $(e){return e==="create"?"Add New Product":e==="edit"?"Edit Product":"View Product"}function de({modalAction:e,close:a}){const t=e.product,[i,n]=m.useState(0),r=D({stock:(t==null?void 0:t.stock)??0},t==null?void 0:t.id);m.useEffect(()=>n(0),[t]);function o(c){c.preventDefault(),r.patch(route("product.update",t==null?void 0:t.id),{preserveScroll:!0,onSuccess:()=>{r.clearErrors(),r.reset(),a()}})}return s.jsx(S,{title:"Update Stock",open:e.open,closeModal:()=>{a(),r.reset(),r.clearErrors()},children:s.jsxs("form",{className:"mt-3",onSubmit:o,children:[s.jsx(p,{id:"stock",label:"Add to Stock",type:"number",name:"stock",autoFocus:!0,value:i,className:"mt-1 block w-full",disabled:r.processing,onChange:c=>{r.setData("stock",((t==null?void 0:t.stock)??0)+Number(c.target.value)),n(Number(c.target.value))},errorMsg:r.errors.stock,hideError:r.isDirty("stock"),onFocus:c=>c.target.select(),required:!0,hint:s.jsxs("span",{children:["Curren stock"," ",s.jsx("span",{className:"font-semibold text-gray-600",children:(t==null?void 0:t.stock)??"N/A"}),". Will update to"," ",s.jsx("span",{className:"font-semibold text-gray-600",children:((t==null?void 0:t.stock)??0)+i})]})}),s.jsxs("div",{className:"mt-4 flex flex-col gap-4 sm:flex-row-reverse",children:[s.jsx(w,{type:"submit",disabled:r.processing,children:"Update"}),s.jsx(k,{type:"button",onClick:()=>{r.cancel(),a(),r.reset(),r.clearErrors()},children:"Cancel"})]})]})})}export{ue as C,de as U};
